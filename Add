-- Hub Anti-Lag Hardcore +FPS

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local StarterPlayer = game:GetService("StarterPlayer")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Camera = Workspace.CurrentCamera

-- ======= GUI =======
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AntiLagHub"
ScreenGui.Parent = PlayerGui

local Hub = Instance.new("Frame")
Hub.Size = UDim2.new(0, 200, 0, 100)
Hub.Position = UDim2.new(0.8,0,0.1,0)
Hub.BackgroundColor3 = Color3.fromRGB(50,50,50)
Hub.BackgroundTransparency = 0.5
Hub.Active = true
Hub.Draggable = true
Hub.Parent = ScreenGui

local FPSButton = Instance.new("TextButton")
FPSButton.Size = UDim2.new(0, 180, 0, 50)
FPSButton.Position = UDim2.new(0,10,0,25)
FPSButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
FPSButton.Text = "+FPS"
FPSButton.TextColor3 = Color3.fromRGB(255,255,255)
FPSButton.Font = Enum.Font.SourceSansBold
FPSButton.TextScaled = true
FPSButton.Parent = Hub

-- FPS display no canto inferior direito
local FPSLabel = Instance.new("TextLabel")
FPSLabel.AnchorPoint = Vector2.new(1,1)
FPSLabel.Position = UDim2.new(1, -10, 1, -10)
FPSLabel.Size = UDim2.new(0,120,0,40)
FPSLabel.BackgroundTransparency = 0.5
FPSLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
FPSLabel.TextColor3 = Color3.fromRGB(255,255,255)
FPSLabel.Font = Enum.Font.SourceSansBold
FPSLabel.TextScaled = true
FPSLabel.Text = "FPS: 0"
FPSLabel.Parent = ScreenGui

-- ======= Anti-lag =======
local AntiLagActive = false
local Connections = {}

local function disableEffects(obj)
    for _, v in pairs(obj:GetDescendants()) do
        if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") or v:IsA("Fire") then
            v.Enabled = false
        elseif v:IsA("Decal") or v:IsA("Texture") then
            v:Destroy()
        elseif v:IsA("AnimationController") or v:IsA("Humanoid") then
            if v.Parent ~= LocalPlayer.Character then
                if v:IsA("Humanoid") then
                    v:Destroy() -- desativa animações de outros players
                else
                    v:Destroy()
                end
            end
        end
    end
end

local function isOnScreen(part)
    local _, onScreen = Camera:WorldToViewportPoint(part.Position)
    return onScreen
end

local function setPartsVisibility()
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character then
            for _, part in pairs(player.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    if player == LocalPlayer then
                        part.Transparency = 0
                        part.CanCollide = true
                    else
                        if not isOnScreen(part) then
                            part.Transparency = 1
                            part.CanCollide = false
                        else
                            part.Transparency = 0
                            part.CanCollide = true
                        end
                    end
                end
            end
        end
    end
end

local function activateAntiLag()
    if AntiLagActive then
        -- Desativa Anti-Lag
        AntiLagActive = false
        FPSButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
        for _, conn in pairs(Connections) do
            conn:Disconnect()
        end
        Connections = {}
        -- Re-renderiza todos
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character then
                for _, part in pairs(player.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.Transparency = 0
                        part.CanCollide = true
                    end
                end
            end
        end
        return
    end

    AntiLagActive = true
    FPSButton.BackgroundColor3 = Color3.fromRGB(0,255,0)

    -- Inicial desativa efeitos
    disableEffects(Workspace)

    -- Remove objetos gigantes
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Part") or obj:IsA("MeshPart") then
            if obj.Size.Magnitude > 50 then
                obj:Destroy()
            end
        end
    end

    -- Anti-lag contínuo
    table.insert(Connections, Workspace.DescendantAdded:Connect(disableEffects))
    table.insert(Connections, RunService.RenderStepped:Connect(setPartsVisibility))
end

FPSButton.MouseButton1Click:Connect(activateAntiLag)

-- ======= AFPS =======
local lastTime = tick()
local frameCount = 0
RunService.RenderStepped:Connect(function()
    frameCount = frameCount + 1
    local now = tick()
    if now - lastTime >= 1 then
        local fps = frameCount
        frameCount = 0
        lastTime = now
        -- Ajusta tamanho do FPS para PC/mobile
        local screenX = Camera.ViewportSize.X
        if screenX < 1000 then
            FPSLabel.TextSize = 14
        else
            FPSLabel.TextSize = 20
        end
        FPSLabel.Text = "FPS: "..fps
    end
end)
